<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Flappy Bird</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    canvas {
      display: block;
    }
    #leaderboard-button {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: white;
      padding: 6px 10px;
      font-size: 14px;
      font-weight: bold;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <button id="leaderboard-button">Leaderboard</button>
  <canvas id="gameCanvas"></canvas>

  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDtbNUO10AIsoEmqjF7...",
      authDomain: "leaderboard-b2da0.firebaseapp.com",
      projectId: "leaderboard-b2da0",
      storageBucket: "leaderboard-b2da0.appspot.com",
      messagingSenderId: "263059182433",
      appId: "1:263059182433:web:325402c0..."
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
  </script>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    let bird = { x: 50, y: 100, vy: 0 };
    let gravity = 0.5;
    let flap = -10;
    let pipes = [];
    let score = 0;
    let gameStarted = false;
    let gameOver = false;
    let bestScore = 0;

    function resetGame() {
      bird.y = 100;
      bird.vy = 0;
      pipes = [];
      score = 0;
      gameOver = false;
    }

    function addPipe() {
      let gap = 200;
      let top = Math.random() * (height - gap - 100);
      pipes.push({ x: width, top });
    }

    function update() {
      if (!gameStarted || gameOver) return;
      bird.vy += gravity;
      bird.y += bird.vy;

      for (let pipe of pipes) {
        pipe.x -= 3;
        if (pipe.x + 50 < 0) pipes.shift();
        if (pipe.x === bird.x) {
          score++;
        }

        if (
          bird.x < pipe.x + 50 &&
          bird.x + 30 > pipe.x &&
          (bird.y < pipe.top || bird.y > pipe.top + 200)
        ) {
          gameOver = true;
          checkLeaderboard();
        }
      }

      if (bird.y > height || bird.y < 0) {
        gameOver = true;
        checkLeaderboard();
      }

      if (pipes.length === 0 || pipes[pipes.length - 1].x < width - 300) {
        addPipe();
      }
    }

    function draw() {
      ctx.fillStyle = "skyblue";
      ctx.fillRect(0, 0, width, height);

      ctx.fillStyle = "green";
      for (let pipe of pipes) {
        ctx.fillRect(pipe.x, 0, 50, pipe.top);
        ctx.fillRect(pipe.x, pipe.top + 200, 50, height);
      }

      ctx.fillStyle = "yellow";
      ctx.beginPath();
      ctx.arc(bird.x, bird.y, 15, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = "black";
      ctx.font = "30px Arial";
      ctx.fillText("Score: " + score, 10, 40);

      if (!gameStarted) {
        ctx.fillText("Tap to Start", width / 2 - 100, height / 2);
      }

      if (gameOver) {
        ctx.fillText("Game Over", width / 2 - 80, height / 2);
      }
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    canvas.addEventListener('click', () => {
      if (!gameStarted) {
        gameStarted = true;
        resetGame();
      } else if (!gameOver) {
        bird.vy = flap;
      } else {
        gameStarted = false;
        resetGame();
      }
    });

    gameLoop();

    async function checkLeaderboard() {
      const scoresRef = db.ref('scores');
      const snapshot = await scoresRef.orderByChild('score').limitToLast(10).once('value');
      const scores = [];
      snapshot.forEach(child => scores.push(child.val()));
      scores.sort((a, b) => b.score - a.score);

      const lowestTopScore = scores.length < 10 ? 0 : scores[9].score;

      if (score > lowestTopScore) {
        const name = prompt("Top 10! Enter your name:");
        if (name) {
          scoresRef.push({ name, score });
        }
      }
    }

    document.getElementById('leaderboard-button').addEventListener('click', () => {
      window.location.href = 'leaderboard.html';
    });
  </script>
</body>
</html>
