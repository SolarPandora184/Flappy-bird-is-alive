<!DOCTYPE html>
<html>
<head>
  <title>Flappy Bird Clone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #70c5ce;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #70c5ce;
    }
    #nameInput {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      display: none;
      z-index: 10;
    }
    #leaderboardBtn {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      z-index: 5;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <div id="nameInput">
    <p>New High Score! Enter your name:</p>
    <input type="text" id="playerName" maxlength="12">
    <button onclick="submitScore()">Submit</button>
  </div>
  <button id="leaderboardBtn" onclick="window.location.href='leaderboard.html'">Leaderboard</button>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

  <!-- Sounds -->
  <audio id="flapSound" src="flappy_whoosh-43099.mp3"></audio>
  <audio id="scoreSound1" src="coin-recieved-230517.mp3"></audio>
  <audio id="scoreSound2" src="coin-257878.mp3"></audio>
  <audio id="hitSound" src="traimory-hit-low-gun-shot-cinematic-trailer-sound-effects-161154.mp3"></audio>

  <script>
    // Replace with your actual Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyA...",
      authDomain: "your-project-id.firebaseapp.com",
      databaseURL: "https://your-project-id-default-rtdb.firebaseio.com",
      projectId: "your-project-id",
      storageBucket: "your-project-id.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abcdef123456"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let width = window.innerWidth;
    let height = window.innerHeight;
    canvas.width = width;
    canvas.height = height;

    const bg = new Image(); bg.src = 'background.png';
    const birdImg = new Image(); birdImg.src = 'IMG_1460.png';
    const pipeImg = new Image(); pipeImg.src = 'FC5CD52C-CB05-42EB-B869-8A34F1FD71F9.png';

    let bird = { x: 80, y: height / 2, vy: 0, rotation: 0 };
    let pipes = [], score = 0, gameStarted = false, gameOver = false;
    let gravity = 0.5, jumpStrength = -8, pipeSpeed = 2.5;
    let flapCooldown = 0, showPassword = !localStorage.getItem("passed");
    let showGameOverY = -200, targetGameOverY = height / 2 - 100;
    let passcode = "caprocz", inputCode = "";

    function drawBird() {
      ctx.save();
      ctx.translate(bird.x, bird.y);
      ctx.rotate(bird.rotation);
      ctx.drawImage(birdImg, -birdImg.width / 2, -birdImg.height / 2);
      ctx.restore();
    }

    function drawPipes() {
      for (let p of pipes) {
        ctx.drawImage(pipeImg, p.x, p.y, p.width, p.height);
      }
    }

    function drawBackground() {
      ctx.drawImage(bg, 0, 0, width, height);
    }

    function drawScore() {
      ctx.fillStyle = "white";
      ctx.font = "40px Arial";
      ctx.fillText(score, width / 2, 50);
    }

    function drawGameOver() {
      ctx.fillStyle = "rgba(0,0,0,0.6)";
      ctx.fillRect(width / 2 - 150, showGameOverY, 300, 200);
      ctx.fillStyle = "white";
      ctx.font = "30px Arial";
      ctx.fillText("Game Over", width / 2 - 80, showGameOverY + 50);
      ctx.font = "20px Arial";
      ctx.fillText("Tap to Restart", width / 2 - 70, showGameOverY + 100);
    }

    function spawnPipe() {
      let gap = 200;
      let topHeight = Math.random() * (height - gap - 200) + 50;
      pipes.push({ x: width, y: 0, width: 60, height: topHeight });
      pipes.push({ x: width, y: topHeight + gap, width: 60, height: height - topHeight - gap });
    }

    function resetGame() {
      bird.y = height / 2;
      bird.vy = 0;
      pipes = [];
      score = 0;
      gameOver = false;
      gameStarted = false;
      showGameOverY = -200;
    }

    function flap() {
      bird.vy = jumpStrength;
      document.getElementById("flapSound").play();
    }

    function animate() {
      ctx.clearRect(0, 0, width, height);
      drawBackground();

      if (!gameStarted && !showPassword) {
        bird.vy += 0.3;
        bird.y += bird.vy;
        if (bird.y >= height / 2) bird.vy = -6;
        drawBird();
        ctx.fillStyle = "white";
        ctx.font = "30px Arial";
        ctx.fillText("Tap to Start", width / 2 - 80, height / 2 + 150);
      } else if (gameStarted) {
        bird.vy += gravity;
        bird.y += bird.vy;
        bird.rotation = Math.min(Math.PI / 4, bird.vy / 10);

        if (--flapCooldown <= 0 && pipes.length === 0) {
          flap();
          flapCooldown = 30;
        }

        for (let p of pipes) p.x -= pipeSpeed;
        pipes = pipes.filter(p => p.x + p.width > 0);

        if (pipes.length === 0 || pipes[pipes.length - 1].x < width - 200) spawnPipe();
        drawPipes();

        for (let p of pipes) {
          if (bird.x + 20 > p.x && bird.x - 20 < p.x + p.width && bird.y + 20 > p.y && bird.y - 20 < p.y + p.height) {
            if (!gameOver) document.getElementById("hitSound").play();
            gameOver = true;
          }
        }

        if (!gameOver) {
          for (let i = 0; i < pipes.length; i += 2) {
            if (!pipes[i].passed && pipes[i].x + pipes[i].width < bird.x) {
              score++;
              pipes[i].passed = true;
              (score % 2 === 0 ? scoreSound1 : scoreSound2).play();
            }
          }
        }

        drawBird();
        drawScore();

        if (bird.y > height || bird.y < 0) gameOver = true;
      }

      if (gameOver) {
        showGameOverY += (targetGameOverY - showGameOverY) * 0.1;
        drawGameOver();
        if (!submitted && isTopScore(score)) {
          document.getElementById("nameInput").style.display = "block";
          submitted = true;
        }
      }

      requestAnimationFrame(animate);
    }

    function isTopScore(newScore) {
      return db.ref("leaderboard").once("value").then(snap => {
        let scores = [];
        snap.forEach(c => scores.push(c.val()));
        scores.sort((a, b) => b.score - a.score);
        return scores.length < 10 || newScore > scores[scores.length - 1].score;
      });
    }

    let submitted = false;
    function submitScore() {
      const name = document.getElementById("playerName").value.trim().slice(0, 12);
      if (!name) return;

      db.ref("leaderboard").push({ name, score });
      document.getElementById("nameInput").style.display = "none";
    }

    canvas.addEventListener("click", () => {
      if (showPassword) return;

      if (!gameStarted) {
        gameStarted = true;
        bird.vy = -8;
        pipes = [];
      } else if (gameOver) {
        resetGame();
      } else {
        flap();
      }
    });

    function handlePassword(e) {
      if (!showPassword) return;
      inputCode += e.key;
      if (inputCode.length > 7) inputCode = inputCode.slice(-7);
      if (inputCode.toLowerCase() === passcode) {
        localStorage.setItem("passed", "1");
        showPassword = false;
      }
    }

    window.addEventListener("keydown", handlePassword);
    animate();
  </script>
</body>
</html>
