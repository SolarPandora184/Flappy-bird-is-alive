<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flappy Bird Clone</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      background: #000;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #70c5ce;
    }
    #leaderboardBtn {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      padding: 6px 10px;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    #leaderboardModal {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border: 2px solid #333;
      padding: 20px;
      z-index: 20;
      text-align: center;
    }
    #leaderboardModal ul {
      list-style: none;
      padding: 0;
      margin: 10px 0;
    }
    #leaderboardModal li {
      margin: 4px 0;
    }
    #leaderboardModal button {
      margin-top: 10px;
      padding: 4px 8px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <button id="leaderboardBtn">Leaderboard</button>
  <div id="leaderboardModal"></div>
  <canvas id="game"></canvas>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDtbNUO10AIsoEmqjqF7lJ9r3UoXJLgJgk",
      authDomain: "leaderboard-b2da0.firebaseapp.com",
      projectId: "leaderboard-b2da0",
      storageBucket: "leaderboard-b2da0.appspot.com",
      messagingSenderId: "263059182433",
      appId: "1:263059182433:web:325402cbeed0b0a7a250bd"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function submitScore(name, score) {
      await db.collection("scores").add({ name, score, time: Date.now() });
    }

    async function getTopScores(limit = 10) {
      const snapshot = await db.collection("scores")
        .orderBy("score", "desc")
        .limit(limit)
        .get();
      return snapshot.docs.map(doc => doc.data());
    }

    async function maybeAddToLeaderboard(score) {
      const top = await getTopScores();
      if (top.length < 10 || score > top[top.length - 1].score) {
        const name = prompt("New High Score! Enter your name:");
        if (name) await submitScore(name, score);
      }
    }

    document.getElementById("leaderboardBtn").onclick = async () => {
      const modal = document.getElementById("leaderboardModal");
      modal.innerHTML = "<p>Loading...</p>";
      modal.style.display = 'block';

      const scores = await getTopScores();
      modal.innerHTML = `<h3>Leaderboard</h3>
        <ul>${scores.map(s => `<li>${s.name}: ${s.score}</li>`).join("")}</ul>
        <button onclick='document.getElementById("leaderboardModal").style.display="none"'>Close</button>`;
    }
  </script>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let bird = { x: 100, y: 200, vy: 0 };
    let pipes = [], score = 0, gameOver = false;

    function reset() {
      bird.y = 200;
      bird.vy = 0;
      pipes = [];
      score = 0;
      gameOver = false;
    }

    function flap() {
      if (!gameOver) bird.vy = -8;
      else {
        maybeAddToLeaderboard(score);
        reset();
      }
    }

    window.addEventListener("click", flap);

    function spawnPipe() {
      let gap = 150;
      let top = Math.random() * (canvas.height - gap - 100) + 50;
      pipes.push({ x: canvas.width, top });
    }

    setInterval(spawnPipe, 1500);

    function loop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      bird.vy += 0.5;
      bird.y += bird.vy;

      ctx.fillStyle = "yellow";
      ctx.beginPath();
      ctx.arc(bird.x, bird.y, 20, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = "green";
      pipes.forEach(p => {
        p.x -= 4;
        ctx.fillRect(p.x, 0, 50, p.top);
        ctx.fillRect(p.x, p.top + 150, 50, canvas.height);

        if (!gameOver && p.x < bird.x && !p.passed) {
          score++;
          p.passed = true;
        }

        if (!gameOver &&
            bird.x + 20 > p.x && bird.x - 20 < p.x + 50 &&
            (bird.y - 20 < p.top || bird.y + 20 > p.top + 150)) {
          gameOver = true;
        }
      });

      if (bird.y > canvas.height || bird.y < 0) gameOver = true;

      ctx.fillStyle = "white";
      ctx.font = "30px Arial";
      ctx.fillText("Score: " + score, 20, 40);

      if (gameOver) {
        ctx.fillText("Game Over - Tap to Restart", 100, 100);
      }

      requestAnimationFrame(loop);
    }
    loop();
  </script>
</body>
</html>
